<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActionController::Rescue</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Module</span> 
            ActionController::Rescue 
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/actionpack/lib/action_controller/rescue_rb.html">actionpack/lib/action_controller/rescue.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Actions that fail to perform as expected throw exceptions. These exceptions
can either be rescued for the public view (with a nice user-friendly
explanation) or for the developers view (with tons of debugging
information). The developers view is already implemented by the Action
Controller, but the public view should be tailored to your specific
application.</p>

<p>The default behavior for public exceptions is to render a static html file
with the name of the error code thrown.  If no such file exists, an empty
response is sent with the correct status code.</p>

<p>You can override what constitutes a local request by overriding the
<code>local_request?</code> method in your own controller. Custom rescue
behavior is achieved by overriding the <code>rescue_action_in_public</code>
and <code>rescue_action_locally</code> methods.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="Rescue/ClassMethods.html">ActionController::Rescue::ClassMethods</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-local_request-3F">local_request?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-log_error">log_error</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-render_optional_error_file">render_optional_error_file</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rescue_action">rescue_action</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rescue_action_in_public">rescue_action_in_public</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rescue_action_locally">rescue_action_locally</a>,
              </li>
            
              
              <li>
                <a href="#method-i-rescue_action_without_handler">rescue_action_without_handler</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">LOCALHOST</td>
            <td>=</td>
            <td class="attr-value">[/^127\.0\.0\.\d{1,3}$/, /^::1$/, /^0:0:0:0:0:0:0:1(%.*)?$/].freeze</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_RESCUE_RESPONSE</td>
            <td>=</td>
            <td class="attr-value">:internal_server_error</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_RESCUE_RESPONSES</td>
            <td>=</td>
            <td class="attr-value">{
&#39;ActionController::RoutingError&#39;             =&gt; :not_found,
&#39;ActionController::UnknownAction&#39;            =&gt; :not_found,
&#39;ActiveRecord::RecordNotFound&#39;               =&gt; :not_found,
&#39;ActiveRecord::StaleObjectError&#39;             =&gt; :conflict,
&#39;ActiveRecord::RecordInvalid&#39;                =&gt; :unprocessable_entity,
&#39;ActiveRecord::RecordNotSaved&#39;               =&gt; :unprocessable_entity,
&#39;ActionController::MethodNotAllowed&#39;         =&gt; :method_not_allowed,
&#39;ActionController::NotImplemented&#39;           =&gt; :not_implemented,
&#39;ActionController::InvalidAuthenticityToken&#39; =&gt; :unprocessable_entity
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_RESCUE_TEMPLATE</td>
            <td>=</td>
            <td class="attr-value">&#39;diagnostics&#39;</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_RESCUE_TEMPLATES</td>
            <td>=</td>
            <td class="attr-value">{
&#39;ActionView::MissingTemplate&#39;       =&gt; &#39;missing_template&#39;,
&#39;ActionController::RoutingError&#39;    =&gt; &#39;routing_error&#39;,
&#39;ActionController::UnknownAction&#39;   =&gt; &#39;unknown_action&#39;,
&#39;ActionView::TemplateError&#39;         =&gt; &#39;template_error&#39;
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">RESCUES_TEMPLATE_PATH</td>
            <td>=</td>
            <td class="attr-value">ActionView::Template::EagerPath.new_and_loaded(
File.join(File.dirname(__FILE__), &quot;templates&quot;))</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Protected methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-local_request-3F">
            
              <b>local_request?</b>()
            
            <a href="../../classes/ActionController/Rescue.html#method-i-local_request-3F" name="method-i-local_request-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>True if the request came from localhost, 127.0.0.1. Override this method if
you wish to redefine the meaning of a local request to include remote IP
addresses or other criteria.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-local_request-3F_source')" id="l_method-i-local_request-3F_source">show</a>
                
              </p>
              <div id="method-i-local_request-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">local_request?</span> <span class="ruby-comment">#:doc:</span>
  <span class="ruby-constant">LOCALHOST</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">local_ip</span><span class="ruby-operator">|</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_addr</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">local_ip</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">local_ip</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-log_error">
            
              <b>log_error</b>(exception)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-log_error" name="method-i-log_error" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Overwrite to implement custom logging of errors. By default logs as fatal.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-log_error_source')" id="l_method-i-log_error_source">show</a>
                
              </p>
              <div id="method-i-log_error_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">log_error</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-comment">#:doc:</span>
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">TemplateError</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">exception</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">fatal</span>(<span class="ruby-identifier">exception</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">fatal</span>(
        <span class="ruby-node">&quot;\n#{exception.class} (#{exception.message}):\n  &quot;</span> <span class="ruby-operator">+</span>
        <span class="ruby-identifier">clean_backtrace</span>(<span class="ruby-identifier">exception</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n  &quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n\n&quot;</span>
      )
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-render_optional_error_file">
            
              <b>render_optional_error_file</b>(status_code)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-render_optional_error_file" name="method-i-render_optional_error_file" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Attempts to render a static error page based on the
<code>status_code</code> thrown, or just return headers if no such file
exists. At first, it will try to render a localized static page. For
example, if a 500 error is being handled <a href="../Rails.html">Rails</a>
and locale is :da, it will first attempt to render the file at
<code>public/500.da.html</code> then attempt to render
<code>public/500.html</code>. If none of them exist, the body of the
response will be left empty.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-render_optional_error_file_source')" id="l_method-i-render_optional_error_file_source">show</a>
                
              </p>
              <div id="method-i-render_optional_error_file_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 107</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">render_optional_error_file</span>(<span class="ruby-identifier">status_code</span>)
  <span class="ruby-identifier">status</span> = <span class="ruby-identifier">interpret_status</span>(<span class="ruby-identifier">status_code</span>)
  <span class="ruby-identifier">locale_path</span> = <span class="ruby-node">&quot;#{Rails.public_path}/#{status[0,3]}.#{I18n.locale}.html&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">locale</span>
  <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;#{Rails.public_path}/#{status[0,3]}.html&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">locale_path</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">locale_path</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">locale_path</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">status</span>, <span class="ruby-value">:content_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-identifier">render</span> <span class="ruby-value">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">path</span>, <span class="ruby-value">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">status</span>, <span class="ruby-value">:content_type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">head</span> <span class="ruby-identifier">status</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-rescue_action">
            
              <b>rescue_action</b>(exception)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-rescue_action" name="method-i-rescue_action" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Exception handler called when the performance of an action raises an
exception.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-rescue_action_source')" id="l_method-i-rescue_action_source">show</a>
                
              </p>
              <div id="method-i-rescue_action_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">rescue_action</span>(<span class="ruby-identifier">exception</span>)
  <span class="ruby-identifier">rescue_with_handler</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">rescue_action_without_handler</span>(<span class="ruby-identifier">exception</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-rescue_action_in_public">
            
              <b>rescue_action_in_public</b>(exception)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-rescue_action_in_public" name="method-i-rescue_action_in_public" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Overwrite to implement public exception handling (for requests answering
false to <code>local_request?</code>).  By default will call
render_optional_error_file.  Override this method to provide more user
friendly error messages.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-rescue_action_in_public_source')" id="l_method-i-rescue_action_in_public_source">show</a>
                
              </p>
              <div id="method-i-rescue_action_in_public_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">rescue_action_in_public</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-comment">#:doc:</span>
  <span class="ruby-identifier">render_optional_error_file</span> <span class="ruby-identifier">response_code_for_rescue</span>(<span class="ruby-identifier">exception</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-rescue_action_locally">
            
              <b>rescue_action_locally</b>(exception)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-rescue_action_locally" name="method-i-rescue_action_locally" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Render detailed diagnostics for unhandled exceptions rescued from a
controller action.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-rescue_action_locally_source')" id="l_method-i-rescue_action_locally_source">show</a>
                
              </p>
              <div id="method-i-rescue_action_locally_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">rescue_action_locally</span>(<span class="ruby-identifier">exception</span>)
  <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-string">&quot;@exception&quot;</span>, <span class="ruby-identifier">exception</span>)
  <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-string">&quot;@rescues_path&quot;</span>, <span class="ruby-constant">RESCUES_TEMPLATE_PATH</span>)
  <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-string">&quot;@contents&quot;</span>,
    <span class="ruby-ivar">@template</span>.<span class="ruby-identifier">render</span>(<span class="ruby-value">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">template_path_for_local_rescue</span>(<span class="ruby-identifier">exception</span>)))

  <span class="ruby-identifier">response</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>
  <span class="ruby-identifier">render_for_file</span>(<span class="ruby-identifier">rescues_path</span>(<span class="ruby-string">&quot;layout&quot;</span>),
    <span class="ruby-identifier">response_code_for_rescue</span>(<span class="ruby-identifier">exception</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-rescue_action_without_handler">
            
              <b>rescue_action_without_handler</b>(exception)
            
            <a href="../../classes/ActionController/Rescue.html#method-i-rescue_action_without_handler" name="method-i-rescue_action_without_handler" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-rescue_action_without_handler_source')" id="l_method-i-rescue_action_without_handler_source">show</a>
                
              </p>
              <div id="method-i-rescue_action_without_handler_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionpack/lib/action_controller/rescue.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">rescue_action_without_handler</span>(<span class="ruby-identifier">exception</span>)
  <span class="ruby-identifier">log_error</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">logger</span>
  <span class="ruby-identifier">erase_results</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">performed?</span>

  <span class="ruby-comment"># Let the exception alter the response if it wants.</span>
  <span class="ruby-comment"># For example, MethodNotAllowed sets the Allow header.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:handle_response!</span>)
    <span class="ruby-identifier">exception</span>.<span class="ruby-identifier">handle_response!</span>(<span class="ruby-identifier">response</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">consider_all_requests_local</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">local_request?</span>
    <span class="ruby-identifier">rescue_action_locally</span>(<span class="ruby-identifier">exception</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">rescue_action_in_public</span>(<span class="ruby-identifier">exception</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    